name: Generate Newsletter

on:
  push:
  workflow_dispatch:
    inputs:
      datefrom:
        description: 'Starting date of merged PRs (inclusive)'
        type: string
        required: true
      dateto:
        description: 'Ending date of merged PRs (inclusive)'
        type: string
        required: true

jobs:
  generate_newsletter:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: Get gq executable
        run: |
          wget https://github.com/pbar1/gq/releases/download/1.4.0/gq_linux_amd64 -O scripts/gq
          chmod +x scripts/gq
          which gq
          command -v gq
      - name: Run the generation script
        run: |
          export DATE_FROM="2023-01-10"
          export DATE_TO="2023-02-10"
          #  export DATE_FROM="${{ github.event.inputs.datefrom }}"
          #  export DATE_TO="${{ github.event.inputs.dateto }}"
          export PATH="${PWD}/scripts:$PATH"
          scripts/generate_newsletter.sh
      - name: Read runtime file
        run: cat 1_runtime.md
      - name: Read node file
        run: cat 2_node.md
      - name: Read the rest file
        run: cat 3_rest.md
