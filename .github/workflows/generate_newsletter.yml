name: Generate Newsletter

on:
  push:
  workflow_dispatch:
    inputs:
      datefrom:
        description: 'Starting date of merged PRs (inclusive)'
        type: string
        required: true
      dateto:
        description: 'Ending date of merged PRs (inclusive)'
        type: string
        required: true

jobs:
  generate_newsletter:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ secrets.NEWSLETTER_GITHUB_PAT }}
    steps:
      - name: checkout
        uses: actions/checkout@v3
      - name: Run the generation script
        run: |
          export DATE_FROM="2023-01-10"
          export DATE_TO="2023-02-10"
          #  export DATE_FROM="${{ github.event.inputs.datefrom }}"
          #  export DATE_TO="${{ github.event.inputs.dateto }}"
          export PATH="${PWD}/scripts:$PATH"
          scripts/generate_newsletter.sh
      - name: Read runtime file
        run: cat 1_runtime.md
      - name: Read node file
        run: cat 2_node.md
      - name: Read the rest file
        run: cat 3_rest.md
      - name: Create a gist
        run: gh gist create 1_runtime.md 2_node.md 3_rest.md
